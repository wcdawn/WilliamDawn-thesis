\chapter{Thermal Hydraulics}
\label{ch:thermalHydraulics}

\section{Introduction}
  For reactor designs are ultimately constrained by thermal properties so
  accurately estimating system temperatures is important to useful simulations.
  Additionally, neutronics properties in the form of cross-sections 
  and density are significantly affected by system temperatures.
  Therefore, to accurately simulate the neutron distribution within the reactor,
  it is necessary to also simulate temperatures within the reactor.

  In this simulation, two thermal hydraulic models are
  employed. The first is a steady-state, one-dimensional axial convection model
  to calculate coolant temperatures as the coolant flows through a channel. This
  model is valid for the assumption of no cross-flow between channels and 
  perfect fluid mixing within the flow channel. For use in simulating fast 
  reactors with canned assemblies and assembly designs which encourage
  within-assembly mixing, these assumptions are valid. The second model used is
  a radial pin-conduction model to calculate cladding, sodium bond, and fuel 
  temperatures based on the heat conduction equation.

  Thermodynamic properties of reactor materials are required for these models.
  The sodium properties required are the most extensive with density, enthalpy, 
  thermal conductivity, dynamic viscosity, and heat capacity required. The 
  functional forms of these properties in this application are given in 
  \cite{sodiumProp}. Additionally, thermal conductivity values are required for 
  cladding and fuel material. Typical cladding for fast reactor designs is HT9
  stainless steel and a functional form of the thermal conductivity is given in
  \cite{ht9Prop}. Fuel composition is assumed to be of the form U-XZr where
  X is the weight fraction of Zr in the fuel. A typical value for X is 10\%.
  Fuel thermal conductivity is given in \cite{fuelProp}. For the expression of
  fuel thermal conductivity given, the integral of thermal conductivity 
  is unbounded as $T \rightarrow 0$ so thermal conductivity is assumed
  constant below 300 \units{K} which is below the melting point of sodium so 
  this assumption is valid for sodium-cooled reactor applications.

\section{Geometric Description}
  For the purposes of the radial model, geometry is described in
  \fref{fig:radial_model}. This model represents a cylindrical fuel pellet,
  surrounded by sodium bond, enclosed in steel cladding, with sodium coolant
  flowing in the axial direction. The center of the fuel pin is located at
  $r=0$ where $r$ is the radial coordinate. The fuel pellet has radius $R_F$ and
  fuel is located in $r \in [0,R_F)$. Then, bond is located in $r \in (R_F,R_B)$
  and clad is located in $r \in (R_B,R_C]$. The fuel center-line temperature is
  $T_0$ and fuel surface temperature is $T_F$. Bond surface temperature is
  $T_B$ and clad surface temperature is $T_C$. $T_{\infty}$ represents the bulk
  coolant temperature. In this model, heat is generated exclusively in the fuel
  with volumetric heat generation rate $q'''$. 

  \begin{figure}
    \centering
    \includegraphics[width=0.5\textwidth]{radial_model}
    \caption{Geometry Description for Thermal Hydraulics Model.}
    \label{fig:radial_model}
  \end{figure}

  In a cross-sectional assembly view, dimensions are presented in
  \fref{fig:pin_model} and \fref{fig:hex_can}. In \fref{fig:hex_can}, $Th_{Box}$
  is the thickness of the assembly box, F2F is the flat-to-flat measurement of
  the outside of the hexagonal can, and Pitch is the distance between the
  center of two pins. In future notation, the quantity ``Pitch'' is also denoted
  $S$. Using the geometry described in these figures, the material
  cross-sectional areas are calculated according to the given formulae where
  $N_{pin}$ is the number of pins in the assembly.
  \begin{align}
    \label{eq:afrac_first}
    A_{total} &= \frac{\sqrt{3}}{2} F2F^2 \\
    A_{can} &= A_{total} - 
      \frac{\sqrt{3}}{2} \left(  F2F - 2 \, Th_{Box} \right) \\
    A_{wrap} &= N_{pin} \frac{\pi}{4} D_{wrap}^2 \\
    A_{clad} &= N_{pin} \pi (R_C^2 - R_B^2) \\
    A_{bond} &= N_{pin} \pi (R_B^2 - R_F^2) \\
    A_{fuel} &= N_{pin} \pi R_F^2 \\
    \label{eq:afrac_last}
    A_{cool} &= A_{total} - A_{can} - A_{wrap} - A_{clad} - A_{bond} - A_{fuel}
  \end{align}
  Calculating the areas as above allows for calculation of cross-sectional area
  fractions. Assuming constant dimensions within an element in the axial
  direction, these area fractions are equivalent to volume fractions and are
  useful for neutron cross-section calculations. Additionally, these formulae
  allow for thermal expansion calculations as the liquid sodium in the bond and
  the coolant are allowed to vary to allow for the expansion of other materials.

  \begin{figure}
    \centering
    \includegraphics[width=0.5\textwidth]{pin_model}
    \caption{Dimensions of Thermal Hydraulic Pin Model.}
    \label{fig:pin_model}
  \end{figure}

  \begin{figure}
    \centering
    \includegraphics[width=0.5\textwidth]{hex_can}
    \caption{Dimensions of Hexagonal Can.}
    \label{fig:hex_can}
  \end{figure}
  
  Used in association with an unstructured mesh, the thermal hydraulic model
  requires mapping mesh elements to reactor assemblies. In the user input to the
  program, the user must specify to which one-dimensional flow channel each
  element belongs.
  Adopting the nomenclature from fast reactors, each flow channel represents a
  hexagonal assembly or a ``hex''. In the following discussion, a hex index is
  subscripted $h$ for $h = 1,2,\ldots,N_h$ where $N_h$ is the number of
  hexagonal assemblies in a reactor. 

  The concept of ``chunks'' is also introduced to aid in the discretization of
  the thermal hydraulic model. A chunk is the set of all elements in a channel
  with a unique axial elevation. For example, in a fast reactor hexagonal
  assembly, the assembly has a unique $h$ index and contains a number of chunks
  equal to the number of axial elevations in the simulation. Additionally, each 
  chunk is required to have unique material composition. The relationship of
  elements, chunks, and hexes is shown in \fref{fig:chunk_description}. Chunks
  are indexed $c = 1,2,\ldots,N_c$ where $N_c$ is the total number of chunks.
  For $N_z$ axial elevations, $N_c = N_h \, N_z$. The indexing
  of chunks is chosen such that $c+N_h$ is the chunk one axial elevation above
  chunk $c$. 

  \begin{figure}
    \centering
    \includegraphics[width=0.7\textwidth]{chunk_description}
    \caption{Progression of Element (left), to Chunk (center), to Hex (right).}
    \label{fig:chunk_description}
  \end{figure}

\section{Power Calculation}
  Recall the multigroup neutron diffusion equation solved via the power
  iteration method returns the largest eigenvalue $\keff$ and unique positive
  eigenvector $\phi_g$ (see \sref{sec:power_iterations}). The flux calculated
  according to this method can be normalized to an arbitrary constant. For a
  specified total reactor power, $Q_{Rx}$ the normalization constant can be 
  calculated. For un-normalized neutron flux $\widetilde{\phi_{g,e}}$ with
  energy group $g$ in element $e$, the normalization constant is written as
  \begin{equation}
    \label{eq:normalization_c}
    c = \frac{Q_{Rx}}{\sum_{g}^{G} \sum_{e}^{N_E} \kappa \Sigma_{f,g,e} \,
      \widetilde{\phi_{g,e}}}
  \end{equation}
  where $c$ is the normalization constant. $\kappa$ represents the reclaimable
  (non-neutrino) energy produced per fission such that the quantity $\kappa
  \Sigma_f \phi$ represents the heat generation rate. Similar to
  $\nu\Sigma_{f,g}$, $\kappa\Sigma_{f,g}$ is calculated as an aggregate
  quantity and not simply $(\kappa)(\Sigma_{f,g}$. Then the true reactor
  neutron flux is given as
  \begin{equation}
    \label{eq:normalization_phi}
    \phi_{g,e} = c \, \widetilde{\phi_{g,e}}
  \end{equation}
  and the power distribution is 
  \begin{equation}
    \label{eq:elementpwr}
    q_{e} = \sum_g^G \kappa \Sigma_{f,e,g} \phi_{g,e}.
  \end{equation}
  For an elemental power $q_e$. The quantity $q_e$ has units \units{W}. Then,
  the volumetric heat generation rate within the fuel is 
  \begin{equation}
    \label{eq:elementqppp_fuel}
    q'''_{e} = \frac{q_e}{V_{fuel,e}}
  \end{equation}
  where $V_{fuel,e}$ is the volume of fuel in element $e$. The quantity $q'''_c$
  has units \units{$\frac{\text{W}}{\text{m}^3}$} will be necessary for the 
  radial conduction model.

  For the one-dimensional heat convection model in the axial direction,
  heat generation quantities are needed for chunks.
  The quantities required are then the total heat generated in a chunk $q_c$ and
  the average volumetric heat generation rate in the fuel for elements within
  the chunk $q'''_c$. These relationships are given in \eref{eq:chunkpwr} and
  \eref{eq:chunkqppp_fuel} respectively. The notation $e \in c$ implies the
  summation over all elements $e$ within chunk $c$.
  \begin{align}
    \label{eq:chunkpwr}
    q_c = \sum_{e \in c} q_e \\
    \label{eq:chunkqppp_fuel}
    q'''_c = \frac{\sum_{e \in c} q'''_e V_{fuel,e}}{\sum_{e \in c} V_{fuel,e}}
  \end{align}

\section{Axial Convection Model}
  \label{sec:axial_convection_model}
  First, the channel mass flow $\mdot_h$ must be calculated for a user specified
  total reactor mass flow rate $\mdot_{Rx}$.  Mass flow is partitioned into each
  channel assuming constant mass flux at the reactor inlet according to 
  \begin{equation}
    \label{eq:mass_flow_split}
    \mdot_h = \mdot_{Rx} \frac{A_{cool,h}N_{pin,h}}{A_{cool,Rx}}
  \end{equation}
  where $A_{cool,h}$ is the coolant flow area for channel $h$, $N_{pin,h}$ is
  the number of pins within the assembly $h$, and $A_{cool,Rx}$
  is the coolant flow area for the reactor.  That is, the mass 
  flow per unit area is assumed constant at the reactor inlet and the mass flow 
  in a channel is the product of the mass flux and the channel flow area. 
  
  The steady-state coolant enthalpy for an axial location $z$ within the channel
  is expressed by a simple heat balance equation as
  \begin{equation}
    \label{eq:continuous_heat_balance}
    h_h(z) = h_{in} + \frac{1}{\mdot_h} \int_0^z q'_h(z') \; dz'
  \end{equation}
  where $h$ is the specific enthalpy, $h_{in}$ is the inlet enthalpy, $\mdot_h$
  is the mass flow rate within the channel, and $q'_h(x)$ is the linear heat 
  generation rate for channel $h$ at elevation $z$. $h_{in}$ is related to a
  user specified 
  $T_{inlet}$ by a state relationship for the coolant $h_{in} = h(T_{inlet})$.
  
  \begin{figure}
    \centering
    \includegraphics[width=0.2\textwidth]{axial_model}
    \caption{One-Dimensional Axial Heat Convection Model Description.}
    \label{fig:axial_model}
  \end{figure}
  
  The integral in \eref{eq:continuous_heat_balance} can be discretized along the
  channel and converted to a summation. In this discretization, the model in
  \fref{fig:axial_model} is used where $h_{c+1/2}$ is the enthalpy at the upper
  elevation of chunk $c$ and $h_c$ is the average enthalpy within the chunk.
  Then, the discretization of the integral \eref{eq:continuous_heat_balance} is 
  \begin{equation}
    \label{eq:heat_balance}
    h_{c+1/2} = 
      h_{in} + \frac{1}{\mdot_h} \sum_{i}^{N_z} q'_{i,h} \Delta z_{i,h}
  \end{equation}
  where $q'_{i,h}$ is the linear heat generation rate in the chunk located at 
  axial level $i$ in channel $h$ and $\Delta z_{i,h} = z_{i+1,h} - z_{i,h}$. 
  (Note: by indexing properly, $c = h + (i-1) \, N_h$.)
  Recognizing the quantity $q_{i,h} = q'_{i,h} \Delta z_{i,h}$
  is the total heat generated in channel $h$ at axial level $i$, then 
  \eref{eq:heat_balance} can be rewritten.
  \begin{equation}
    h_{c+1/2} = h_{in} + \frac{1}{\mdot_h} \sum_i^{N_z} q_{i,h}
  \end{equation}
  The quantity $h_{c+1/2}$ represents the enthalpy in channel $h$ at the upper 
  coordinate of the one-dimensional heat convection chunk (see
  \fref{fig:axial_model}). The node-average 
  enthalpy is instead desired. To first-order approximation, then
  \begin{equation}
    h_c = \half (h_{i-1/2,h} + h_{i+1/2,h})
  \end{equation}
  where $h_c$ is the average enthalpy in chunk $c$ located in channel $h$ at
  axial level $i$.
  The final result of this model is $h_c$, the bulk coolant enthalpy in each
  chunk $c$. Given, $h_c$, bulk coolant temperature $T_{\infty,c} = T(h_c)$ can
  be calculated using a state relationship in \cite{sodiumProp}. Bulk coolant
  temperature will be an input into the Radial Conduction Model, 
  \sref{sec:radial_conduction_model}, to later calculate the average material
  temperatures.
  
\section{Radial Conduction Model}
  \label{sec:radial_conduction_model}
  The radial heat conduction model is intended to describe the steady-state heat
  conduction from its generation in the fuel to the coolant. A pin model as
  described in \fref{fig:radial_model} is assumed with explicit treatment of
  fuel, sodium bond, and cladding regions. For this model, it is assumed that
  $T_{\infty}$ is known within the chunk as calculated in
  \sref{sec:axial_convection_model}. Then, the model begins by calculating
  temperatures at key locations. Material temperature is calculated at the fuel
  center-line, fuel surface, bond surface, and clad surface. The derivation of
  these quantities are presented in \sref{sec:surface_temps}. Similar results
  can be found in \cite{FastSpectrumReactors}.
  
  With the
  temperatures at these locations calculated, the average temperature within
  each material is calculated. These average temperatures are essential for the
  accurate simulation of the reactor as they influence multigroup constants.

  \subsection{Surface Temperature and Center-Line Temperatures}
    \label{sec:surface_temps}
    Temperatures at selected locations are calculated using the steady-state
    heat conduction equation with variable thermal conductivity. No restrictions
    are placed on the functional form of the materials thermal conductivities
    and the method remains general. The process of the derivation moves outward
    from the fuel center-line always assuming that the next temperature is
    known. That is, derivation begins with the fuel center-line temperature,
    assuming the fuel surface temperature is known. Then, derivation moves to
    the fuel surface temperature assuming the bond surface temperature is known.
    This pattern is terminated and the relationship is closed at the cladding
    surface where, for a given $T_{\infty}$ the clad surface temperature is
    described by Newton's law of cooling and some convective heat transfer
    correlation. For this application, the Weisman correlation is selected for
    its applicability to triangular-pitch flow channels.

    With derivation completed, the temperatures of interest are calculated.
    While derivation moved from fuel center-line outward to clad surface,
    calculation moves from clad surface inward to fuel center-line. This is
    necessary because the quantities are all unknown with the exception of
    $T_{\infty}$ so the calculation begins there. Clad surface temperature is 
    the only temperature solved explicitly as it is specified by Newton's law of
    cooling. All other temperatures are solved implicitly. In these implicit
    solutions, the value of a conductivity integral is calculated. The 
    conductivity integral is described as
    \begin{equation}
      \label{eq:conductivity_integral}
      K(T) = \int_0^T k(T') \; dT'
    \end{equation}
    where $k(T)$ is the thermal conductivity of the material and $K(T)$ is the
    conductivity integral. Then, for a given $K(T)$, $T$ may be calculated using
    a numerical solution method. In this application, a bisection method is 
    implemented for its robustness. A faster numerical solution method could 
    later be implemented but the bisection method was chosen for its generality
    and simplicity.

    \subsubsection{Fuel Center-Line Temperature}
      The fueled region is the only region modeled with non-zero volumetric heat
      generation. In this region, $q'''_c$ as specified by 
      \eref{eq:chunkqppp_fuel} is assumed constant within the fuel. 
      Additionally, the thermal conductivity in the fuel will be assumed to have
      general form $k_F(T)$. For this application, $k_F(T)$ is specified by the
      functional form in \cite{fuelProp} assuming 10\% Zr by weight included in
      fuel.

      The steady-state heat conduction equation with constant volumetric heat
      generation rate $q'''_c$ and variable thermal conductivity $k_F(T)$ can be
      written.
      \begin{equation}
        \label{eq:conduction_fuel}
        \grad \cdot (k_F(T_F(r)) \grad T_F(r)) + q'''_c = 0
      \end{equation}
      Noting the gradient operator in cylindrical geometry,
      \eref{eq:conduction_fuel} is rewritten with partial derivatives.
      \begin{equation}
        \label{eq:conduction_fuel_cylindrical}
        \frac{1}{r} \frac{\partial}{\partial r} \left( r \, k_F(T_F(r)) \, 
          \frac{d \, T_F}{dr} \right) + q'''_c = 0
      \end{equation}
      Note the inner derivative is an ordinary derivative because the only
      function to which it applies, $T_F(r)$, is a function of one variable. The
      outer derivative is a partial derivative because it applies to $T_F(r)$ as
      well as $k_F(T_F(r))$.

      Begin solving \eref{eq:conduction_fuel_cylindrical} by multiplying the
      equation by radial coordinate $r$.
      \begin{equation}
        \frac{\partial}{\partial r} \left( k_F(T_F(r)) \, \frac{d\, T_F}{dr} 
        \right) + q'''_c = 0
      \end{equation}
      Integrate the equation for $r \in [0,r']$ where $r'$ is an arbitrary
      location $r' \in [0,R_F]$.
      \begin{align}
        \int_0^{r'} \left( \frac{\partial}{\partial r} \left( k_F(T_F(r)) \, 
          \frac{d\, T_F}{dr} \right) + q'''_c \right) \; dr &= 0 \\
        \int_0^{r'} \frac{\partial}{\partial r} \left( k_F(T_F(r)) 
          \frac{d \, T_F}{dr} \right) \; dr + \int_0^{r'} q'''_c \; dr &= 0 \\
        \left. r \, k_F(T_F(r)) \frac{d\,T_F}{dr} \right|_{r=0}^{r=r'} + 
          \left. \frac{q'''_c}{2} r^2 \right|_{r=0}^{r=r'} &= 0 \\
        \label{eq:dtdr_fuel}
        \left. r' k_F(T_F(r')) \frac{d\,T_F}{dr} \right|_{r=r'} + 
          \frac{q'''_c}{2} r^{\prime 2} &= 0
      \end{align}
      Divide by the location $r'$.
      \begin{equation}
        \left. k_F(T_F(r')) \frac{d \, T_F}{dr}\right|_{r=r'} + 
          \frac{q'''_c}{2} r' = 0
      \end{equation}
      Next, integrate $r' \in [0,r]$.
      \begin{align}
        \int_0^r \left( k_F(T_F(r')) \left. \frac{d\,T_F}{dr}\right|_{r=r'} 
          + \frac{q'''_c}{2} r' \right) \; dr' &= 0 \\
        \int_0^r k_F(T_F(r')) \left. \frac{d\,T_F}{dr}\right|_{r=r'} \; dr' + 
          \int_0^r \frac{q'''_c}{2} r' \; dr' &= 0 \\
        \int_0^r k_F(T_F(r')) \left. \frac{d\,T_F}{dr}\right|_{r=r'} \; dr' + 
          \left. \frac{q'''_c}{4} r^{\prime 2} \right|_{r'=0}^{r'=r} &= 0 \\
        \int_0^r k_F(T_F(r')) \left. \frac{d\,T_F}{dr}\right|_{r=r'} \; dr' + 
          \frac{q'''_c}{4} r^2 &= 0
      \end{align}
      The fundamental theorem of calculus allows for the expression of the first
      integral.
      \begin{equation}
        \label{eq:tcl_integral}
        \int_{T_F(0)}^{T_F(r)} k_F(T_F(r)) \; dr + \frac{q'''_c}{4} r^2 = 0
      \end{equation}
      In this derivation, $k_F(T)$ is allowed to be a generic function. 
      Therefore, \eref{eq:tcl_integral} does not have a simple forward 
      expression. Solving for $T_F(0)$ will require a non-linear search such as
      the bisection method. Define the conductivity integral of the fuel
      conductivity in the form \eref{eq:conductivity_integral}.
      Then, \eref{eq:tcl_integral} can be rewritten.
      \begin{gather}
        K_F(T_F(r)) - K_F(T_F(0)) + \frac{q'''_c}{4} r^2 = 0 \\
        \label{eq:tfuel_r}
        K_F(T_F(0)) = K_F(T_F(r)) + \frac{q'''_c}{4} r^2 \\
        \label{eq:tcl_conductivity_integral}
        K_F(T_F(0)) = K_F(T_F) + \frac{q'''_c}{4} R_F^2
      \end{gather}
      The fuel center-line temperature can be calculated using
      \eref{eq:tcl_conductivity_integral} given a functional form of the
      conductivity integral $K_F(T)$ by performing a search on the function
      where $T_F(0)$ is the fuel center-line temperature, $T_F=T_F(R_F)$ is the
      fuel surface temperature, and $R_F$ is the radius of the fuel. To
      calculate $T_F(0)$, the fuel surface temperature must be known.
      If more information is known about $K_F(T)$, a forward expression
      may be possible. However, a bisection method is implemented to maintain
      generality.

    \subsubsection{Fuel Surface Temperature}
      The fuel surface temperature is calculated by considering the heat
      conduction equation in the sodium bond region. There is no heat generation
      in this region so $q'''=0$.
      The steady-state heat conduction equation with no heat generation is
      written as
      \begin{equation}
        \label{eq:tc_grad}
        \grad \cdot (k_B(T_B(r)) \grad T_B(r)) = 0
      \end{equation}
      where $k_B(T)$ is a general expression for the thermal conductivity in the
      sodium bond and is given by a state relationship in \cite{sodiumProp}.
      $T_B(r)$ is the temperature within the cladding region.
      In this region, good thermal contact between the fuel and bond is
      assumed such that
      \begin{equation}
        \label{eq:rf_temp_continuity}
        T_F(R_F)=T_B(R_F).
      \end{equation}
      That is, the temperature is 
      continuous at the material discontinuity. Additionally, constant heat flux
      is assumed at the material discontinuity such that
      \begin{equation}
        \label{eq:rf_flux_continuity}
        k_F(T_F(R_F)) \left.\frac{d\,T_F}{dr}\right|_{r=R_F} = 
          k_B(T_B(R_F)) \left.\frac{d\,T_B}{dr}\right|_{r=R_F}.
      \end{equation}

      Recognizing cylindrical geometry, \eref{eq:tc_grad} can be rewritten.
      \begin{equation}
        \label{eq:tb_heat_conduction}
        \frac{1}{r} \frac{\partial}{\partial r} \left(
          r \, k_B(T_B(r)) \frac{d \, T_B}{dr} \right) = 0
      \end{equation}
      Begin solving \eref{eq:tb_heat_conduction} by multiplying the equation by
      the radial coordinate $r$.
      \begin{equation}
        \frac{\partial}{\partial r} \left( r \, k_B(T_B(r)) \frac{d \, T_B}{dr}
          \right) = 0
      \end{equation}
      Integrate the equation for $r \in[R_F,r']$ where $r'$ is an arbitrary
      location $r' \in [R_F,R_B]$.
      \begin{align}
        \int_{R_F}^{r'} \frac{\partial}{\partial r} \left( r\, k_B(T_B(r)) \, 
          \frac{d\,T_B}{dr} \right) \; dr &= 0\\
        \left. r\, k_B(T_B(r)) \frac{d\,T_B}{dr} \right|_{r=R_F}^{r=r'} &= 0 \\
        \label{eq:tf_first_integral}
        \left. r' \, k_B(T_B(r')) \frac{d\,T_B}{dr} \right|_{r=r'} - 
          \left. R_F \, k_B(T_B(R_F)) \frac{d\,T_B}{dr} \right|_{r=R_F} &= 0
      \end{align}
      The assumption of constant heat flux in \eref{eq:rf_flux_continuity} 
      allows for the treatment of the spatial derivative at $R_F$. Recall from
      the derivation within the fuel region, the expression \eref{eq:dtdr_fuel}
      is exploited. The expression is valid for any $r' \in [0,R_F]$ so allow
      $r'=R_F$.
      \begin{align}
        \left. R_F k_F(T_F(R_F)) \frac{d\,T_F}{dr} \right|_{r=R_F} + 
          \frac{q'''_c}{2} R_F^2 &= 0 \\
        \label{eq:surface_relation}
        \left. R_F k_F(T_F(R_F)) \frac{d\,T_F}{dr} \right|_{r=R_F} &= 
          - \frac{q'''_c}{2} R_F^2
      \end{align}
      Recall from the earlier derivation of the fuel center-line temperature 
      that the quantity $q'''_c$ is the average volumetric heat generation rate
      within chunk $c$ specified in \eref{eq:chunkqppp_fuel}.
      \eref{eq:surface_relation} is substituted into
      \eref{eq:tf_first_integral}.
      \begin{equation}
        \label{eq:tf_first_bc}
        \left. r' \, k_B(T_B(r')) \frac{d\,T_B}{dr} \right|_{r=r'} +
          \frac{q'''_c}{2} R_F^2 = 0
      \end{equation}
      Divide \eref{eq:tf_first_integral} by the radial coordinate $r'$. This is
      valid because $r' \ne 0$ in this region.
      \begin{equation}
        \left. k_B(T_B(r')) \frac{d\,T_B}{dr} \right|_{r=r'} + 
          \frac{q'''_c}{2} \frac{R_F^2}{r'} = 0
      \end{equation}
      Integrate the equation for $r' \in [R_F,r]$ where $r \in [R_F,r']$.
      \begin{align}
        \int_{R_F}^r \left( \left. k_B(T_B(r')) \frac{d\,T_B}{dr}\right|_{r=r'}
          + \frac{q'''_c}{2} \frac{R_F^2}{r'} \right) \; dr' &= 0 \\
        \int_{R_F}^r \left. k_B(T_B(r')) \frac{d\,T_B}{dr}\right|_{r=r'} \; dr'
          + \int_{R_F}^r \frac{q'''_c}{2} \frac{R_F^2}{r'} \; dr' &= 0\\
        \int_{R_F}^r \left. k_B(T_B(r')) \frac{d\,T_B}{dr}\right|_{r=r'} \; dr'
          + \frac{q'''_c}{2} R_F^2 \left. \ln(r') \right|_{r'=R_F}^{r'=r} &= 0\\
        \int_{R_F}^r \left. k_B(T_B(r')) \frac{d\,T_B}{dr}\right|_{r=r'} \; dr'
          + \frac{q'''_c}{2} R_F^2 ( \ln(r) - \ln(R_F)) &= 0 \\
        \int_{R_F}^r \left. k_B(T_B(r')) \frac{d\,T_B}{dr}\right|_{r=r'} \; dr'
          + \frac{q'''_c}{2} R_F^2 \ln\left(\frac{r}{R_F}\right) &= 0 
      \end{align}
      Again, the remaining integral can be rewritten by employing the
      fundamental theorem of calculus.
      \begin{equation}
        \label{eq:tf_fundamental_theorem}
        \int_{T_B(R_F)}^{T(r)} k_B(T_B(r)) \; dT + \frac{q'''_c}{2} R_F^2 
          \ln\left(\frac{r}{R_F}\right) = 0
      \end{equation}
      Defining a conductivity integral function $K_B(T)$ similar to
      \eref{eq:conductivity_integral}, \eref{eq:tf_fundamental_theorem} can be
      rewritten.
      \begin{gather}
        K_B(T_B(r)) - K_B(T_B(R_F)) + \frac{q'''_c}{2} R_F^2
          \ln\left(\frac{r}{R_F}\right) = 0 \\
        \label{eq:tbond_r}
        K_B(T_B(R_F)) = K_B(T_B(r)) + \frac{q'''_c}{2} R_F^2
          \ln\left(\frac{r}{R_F}\right) \\
        \label{eq:tf_conductivity_integral}
        K_B(T_F) = K_B(T_B) + \frac{q'''_c}{2} R_F^2
          \ln\left(\frac{R_B}{R_F}\right)
      \end{gather}
      The fuel surface temperature can be calculated using
      \eref{eq:tf_conductivity_integral} given a functional form of the
      conductivity integral $K_B(T)$ by performing a search on the function. In
      \eref{eq:tf_conductivity_integral}, $T_F=T_B(R_F)$ is the fuel surface 
      temperature, $T_B=T_B(R_B)$ is the bond surface temperature and must be
      given to use this expression.

    \subsubsection{Bond Surface Temperature}
      Consider the heat conduction equation in the cladding region. Derivation
      of the bond surface temperature $T_B=T_B(R_B)$ is similar to
      the fuel surface temperature because both consider a heat conduction
      equation with no heat generation. The derivation in its entirety is
      presented to ensure completeness and correctness. The steady-state heat 
      conduction equation for this region is written as
      \begin{equation}
        \label{eq:clad_conduction_grad}
        \grad \cdot (k_C(T_C(r)) \grad T_C(r)) = 0
      \end{equation}
      where $k_C(T)$ is a functional form of the thermal conductivity in the
      cladding from \cite{ht9Prop}. $T_C(r)$ is the temperature within the
      cladding region and $T_C=T_C(R_C)$ is the cladding surface temperature. 
      In this region, good thermal contact is assumed between the sodium bond
      and the cladding such that
      \begin{equation}
        \label{eq:rb_temp_continuity}
        T_B(R_B)=T_C(R_B).
      \end{equation}
      Additionally, constant heat flux is assumed at the
      cladding-bond boundary such that
      \begin{equation}
        \label{eq:rb_flux_continuity}
        \left. k_B(T_B(R_C)) \frac{d\,T_B}{dr}\right|_{r=R_C} = 
          \left. k_C(T_C(R_C)) \frac{d\,T_C}{dr}\right|_{r=R_F}.
      \end{equation}

      Rewriting the gradient for cylindrical geometry,
      \eref{eq:clad_conduction_grad}.
      \begin{equation}
        \label{eq:clad_conduction}
        \frac{1}{r} \frac{\partial}{\partial r} \left( r\, k_C(T_C(r)) 
          \frac{d\,T_C}{dr} \right) = 0
      \end{equation}
      Begin solving \eref{eq:clad_conduction} by multiplying the equation by the
      radial coordinate $r$.
      \begin{equation}
        \frac{\partial}{\partial r} \left( r\,k_C(T_C(r))\,\frac{d\,T_C}{dr}
          \right) = 0
      \end{equation}
      Integrate the equation through $r \in [R_B,r']$ where $r'$ is an arbitrary
      coordinate $r' \in [R_B,R_C]$.
      \begin{align}
        \int_{R_B}^{r'} \frac{\partial}{\partial r} \left( r \, k_C(T_C(r))
          \frac{d\,T_C}{dr} \right) \; dr &= 0 \\
        \left. r\,k_C(T_C(r)) \frac{d\,T_C}{dr} \right|_{r=R_B}^{r=r'} &= 0 \\
        \label{eq:clad_before}
        \left. r' \, k_C(T_C(r')) \frac{d\,T_C}{dr} \right|_{r=r'} - 
          \left. R_B \, k_C(T_C(R_B)) \frac{d\,T_C}{dr} \right|_{r=R_B} &= 0
      \end{align}
      The assumption of constant heat flux at the material discontinuity at
      $R_B$ as in \eref{eq:rb_flux_continuity} allows for an expression of the 
      derivative at $R_B$. Recall from the derivation within the bond region,
      the expression \eref{eq:tf_first_bc} can be used. The expression is valid
      for any $r' \in [R_F,R_B]$ so allow $r'=R_B$.
      \begin{align}
        \left. R_B \, k_B(T_B(R_B)) \frac{d\,T_B}{dr} \right|_{r=R_B} +
          \frac{q'''_c}{2} R_F^2 &= 0 \\
        \label{eq:clad_bc_relation}
        \left. R_B \, k_B(T_B(R_B)) \frac{d\,T_B}{dr} \right|_{r=R_B} &= 
          - \frac{q'''_c}{2} R_F^2
      \end{align}
      Recalling again that $q'''_c$ is the average volumetric heat generation
      rate in the fuel within chunk $c$ given in \eref{eq:chunkqppp_fuel}.
      \eref{eq:clad_bc_relation} is inserted into \eref{eq:clad_before}.
      \begin{equation}
        \left. r' \, k_C(T_C(r')) \frac{d\,T_C}{dr} \right|_{r=r'} + 
          \frac{q'''_c}{2} R_F^2 = 0
      \end{equation}
      Divide by $r'$ because $r' \ne 0$ in this region.
      \begin{equation}
        \left. k_C(T_C(r')) \frac{d\,T_C}{dr} \right|_{r=r'} + 
          \frac{q'''_c}{2} \frac{R_F^2}{r'} = 0
      \end{equation}
      Integrate the equation for $r' \in [R_B,r]$ where $r \in [R_B,r']$.
      \begin{align}
        \int_{R_B}^r \left( \left. k_C(T_C(r')) \frac{d\,T_C}{dr} \right|_{r=r'}
          + \frac{q'''_c}{2} \frac{R_F^2}{r'} \right) \; dr' &= 0 \\
        \int_{R_B}^r \left. k_C(T_C(r')) \frac{d\,T_C}{dr} \right|_{r=r'} \; dr'
          + \int_{R_B}^r \frac{q'''_c}{2} \frac{R_F^2}{r'} \; dr' &= 0 \\
        \int_{R_B}^r \left. k_C(T_C(r')) \frac{d\,T_C}{dr} \right|_{r=r'} \; dr'
          + \frac{q'''_c}{2} R_F^2 \left. \ln(r') \right|_{r'=R_B}^{r'=r} &= 0\\
        \int_{R_B}^r \left. k_C(T_C(r')) \frac{d\,T_C}{dr} \right|_{r=r'} \; dr'
          + \frac{q'''_c}{2} R_F^2 (\ln(r) - \ln(R_B)) &= 0\\
        \int_{R_B}^r \left. k_C(T_C(r')) \frac{d\,T_C}{dr} \right|_{r=r'} \; dr'
          + \frac{q'''_c}{2} R_F^2 \ln\left(\frac{r}{R_B}\right) &= 0
      \end{align}
      Again, the integral term can be rewritten with use of the fundamental
      theorem of calculus.
      \begin{equation}
        \label{eq:clad_integral}
        \int_{T_C(R_B)}^{T_C(r)} k_C(T_C(r)) \; dr +
          \frac{q'''_c}{2} R_F^2 \ln\left(\frac{r}{R_B}\right) = 0
      \end{equation}
      Defining a conductivity integral function $K_C(T)$ similar to
      \eref{eq:conductivity_integral}, \eref{eq:clad_integral} can be rewritten.
      \begin{gather}
        K_C(T_C(r)) - K_C(T_C(R_B)) + \frac{q'''_C}{2} R_F^2
          \ln\left(\frac{r}{R_B}\right) = 0 \\
        \label{eq:tclad_r}
        K_C(T_C(R_B)) = K_C(T_C(r)) + \frac{q'''_c}{2} R_F^2
          \ln\left(\frac{r}{R_B}\right) \\
        \label{eq:ktb}
        K_C(T_B) = K_C(T_C) + \frac{q'''_C}{2} R_F^2
          \ln\left(\frac{R_C}{R_B}\right) 
      \end{gather}
      The bond surface temperature can be calculated using \eref{eq:ktb} given a
      function describing the cladding conductivity integral $K_C(T)$ and
      performing a bisection method search on the function. In \eref{eq:ktb},
      $T_B = T_C(R_B)$ is the bond surface temperature, $T_C=T_C(R_C)$ is the
      clad surface temperature and is calculated using a different method and
      treated as an input to this method.  

    \subsubsection{Clad Surface Temperature}
      Clad surface temperature $T_C$ is given by Newton's Law of Cooling with
      convective heat transfer coefficient $H$ specified according to the
      Weisman Correlation. Newton's Law of Cooling may be written as
      \begin{equation}
        q''_{clad} = H (T_C - T_{\infty})
      \end{equation}
      where $q''_{clad}$ is the heat flux at the clad surface $R_C$, $H$ is
      the convective heat transfer coefficient, $T_C$ is the clad surface
      temperature, and $T_{\infty}$ is the bulk coolant temperature. Using the
      relationships in \sref{sec:axial_convection_model}, $T_{\infty}$ is given
      by the state relationship $T_{\infty} = T(h_c)$ from \cite{sodiumProp}.
      The heat flux at the clad surface is related to the volumetric heat 
      generation rate in the fuel according to 
      \begin{equation}
        q''_{clad} = q'''_c \frac{R_F^2}{2 R_C}
      \end{equation}
      where $q'''_c$ is the chunk-average volumetric heat generation rate in the
      fuel according to \eref{eq:chunkqppp_fuel}.

      The coefficient $H$ must be calculated via an applicable correlation.
      The Weisman correlation is selected because it is valid for general fluid
      flow and has parameters correlated for triangular pitch flow areas common
      to fast reactor designs. The Weisman Correlation relates the Nusselt,
      Reynolds, and Prandlt dimensionless numbers according to
      \begin{equation}
        \label{eq:weisman}
        Nu = C \, Re^{0.8} \, Pr^{1/3}
      \end{equation}
      where $Nu$ is the Nusselt number, $Re$ is the Reynolds number, $Pr$ is 
      the Prandlt number, and $C$ is a correlation coefficient specified by the
      triangular geometry. For triangular pitch flow, the geometry is described
      as
      \begin{align}
        \label{eq:weisman_c}
        C &= 0.026 \frac{S}{2 \, R_C} - 0.006 \\
        \label{eq:weisman_ax}
        A_x &= \frac{\sqrt{3}}{4} S^2 - \frac{\pi R_C^2}{2} \\
        \label{eq:weisman_pw}
        P_w &= \pi R_C \\
        \label{eq:weisman_de}
        D_e &= \frac{4 \, A_x}{P_w}
      \end{align}
      where $S$ is the pitch between pins (see \fref{fig:hex_can}), $A_x$ is the
      flow cross-sectional area, $P_w$ is the flow wetted perimeter, and $D_e$
      is the effective flow diameter. The Reynolds number is defined as
      \begin{equation}
        \label{eq:re}
        Re = \frac{\mdot_h \, D_e}{A_x \, \mu}
      \end{equation}
      where $\mdot_h$ is the assembly mass flow rate, $\mu$ is the fluid's
      dynamic viscosity given by a state relationship, and $D_e$ and $A_x$ are 
      defined according to \eref{eq:weisman_de} and \eref{eq:weisman_ax}
      respectively. The Prandtl number is defined according to 
      \begin{equation}
        \label{eq:pr}
        Pr = \frac{c_p \, \mu}{k}
      \end{equation}
      where $c_p$ is the fluid specific heat capacity at constant pressure, 
      $\mu$ is the fluid dynamic viscosity, and $k$ is the fluid thermal 
      conductivity. Note that each of these quantities are given by state 
      relationships. As such, the Prandtl number can itself be correlated for a
      given fluid as a state relationship.
      
      With the dimensionless quantities expressed in \eref{eq:re} and
      \eref{eq:pr}, the Weisman correlation is used to calculate the Nusselt
      number. Given a Nusselt number, the convective heat transfer coefficient
      is defined as
      \begin{equation}
        \label{eq:hc}
        H = \frac{Nu \, k}{D_e}
      \end{equation}
      where $Nu$ is the Nusselt number from the Weisman correlation
      \eref{eq:weisman}, $k$ is the fluid thermal conductivity given by a state
      relationship, and $D_e$ is the effective flow diameter given in
      \eref{eq:weisman_de}. Finally, the clad surface temperature is expressed.
      \begin{align}
        T_C &= \frac{q''_{clad}}{H} + T_{\infty} \\
        \label{eq:tc}
        T_C &= q'''_c \frac{R_F^2}{2\,R_c\,H} + T_{\infty}
      \end{align}
      With \eref{eq:tc}, all surface temperatures and the fuel center-line
      temperature have been related to $T_{\infty}$ and the calculation of these
      quantities may begin, moving from the coolant toward the fuel center-line.

  \subsection{Average Temperatures}
    \label{sec:average_temps}
    Average material temperatures are used to evaluate material properties such
    as densities and cross-sections within the different material regions. The
    derivations in this section require the fuel center-line and surface
    temperatures from \sref{sec:surface_temps}. The principle of the method
    presented for estimating average temperatures is the assumption that the
    average temperature within a material, $\overline{T}$, corresponds 
    to the average value of the conductivity integral in that region,
    $\overline{K(T(r))}$. That is, $\overline{K(T(r))} \approx K(\overline{T})$
    such that $\overline{T} \approx K^{-1}(\overline{K(T(r))})$.
    Generally, this need not be true. However, for the materials and associated
    conductivity integrals presented here, this approximation is valid. In a
    comparison case for typical reactor conditions, the numerical evaluation of
    the average temperature agreed to this method within the tolerance of the
    numerical solution method ($1 \units{K}$). Given this assumption, the
    following relationships are used.

    \subsubsection{Average Fuel Temperature}
      Recall the expression for the conductivity integral $K_F(T_F(r))$ for $r
      \in [0,R_F]$ given in \eref{eq:tfuel_r}. The equation can be rewritten as
      \begin{equation}
        K_F(T_F(r)) = K_F(T_0) - \frac{q'''_c}{4} r^2
      \end{equation}
      where $T_0=T_F(0)$ is the fuel center-line temperature calculated 
      previously.
      Then, the average fuel conductivity integral within the fuel material is 
      \begin{align}
        \overline{K_F} &= \frac{\int_0^{R_F} K_F(T_F(r)) \, r \; dr}
          {\int_0^{R_F} r \; dr} \\
        \label{eq:kf_integral}
        \overline{K_F} &= \frac{\int_0^{R_F} 
          \left( K_F(T_0) - \frac{q'''_c}{4} r^2 \right)
          \, r \; dr}{\int_0^{R_F} r \; dr}
      \end{align}
      noting the $r$ multiplication term due to the cylindrical
      coordinates. Begin with evaluating the integral in the denominator
      of \eref{eq:kf_integral}.
      \begin{align}
        \int_0^{R_F} r \; dr &= \left. \frac{r^2}{2} \right|_{r=0}^{r=R_F} \\
        \label{eq:kf_denominator}
        \int_0^{R_F} r \; dr &= \frac{R_F^2}{2}
      \end{align}
      Next, the integral in the numerator of \eref{eq:kf_integral} is evaluated.
      \begin{align}
        \int_0^{R_F} \left( K_F(T_0) - \frac{q'''_c}{4} r^2 \right) \, r \; dr&=
          \int_0^{R_F} \left( K_F(T_0) \, r - \frac{q'''_c}{4} r^3 \right) \;
          dr\\
        &= \left. K_F(T_0) \frac{r^2}{2} \right|_{r=0}^{r=R_F} -
          \left. \frac{q'''_c}{4} \frac{r^4}{4} \right|_{r=0}^{r=R_F} \\
        \label{eq:kf_numerator}
        &= K_F(T_0) \frac{R_F^2}{2} - \frac{q'''_c}{16} R_F^4
      \end{align}
      Evaluating \eref{eq:kf_integral} by dividing \eref{eq:kf_numerator} by
      \eref{eq:kf_denominator} yields an expression for the average value of the
      conductivity integral in the fuel region.
      \begin{equation}
        \label{eq:kf_bar}
        \overline{K_F} = K_F(T_0) - \frac{q'''_c}{8} R_F^2
      \end{equation}
      Assuming $\overline{K_F} = K_F(\overline{T_F})$, then \eref{eq:kf_bar} can
      be solved using a numerical method to determine $\overline{T_F}$. In this
      application, the bisection method is used to solve \eref{eq:kf_bar}.

    \subsubsection{Average Bond Temperature}
      \label{sec:average_bond_temp}
      The value of the bond conductivity integral at position $r \in [R_F,R_B]$
      is given in \eref{eq:tbond_r} and can be rewritten as
      \begin{equation}
        K_B(T_B(r)) = K_B(T_F) - \frac{q'''_c}{2} R_F^2
          \ln\left(\frac{r}{R_F}\right)
      \end{equation}
      where $T_F=T_B(R_F)$ is the fuel surface temperature already calculated.
      The average value of the bond conductivity integral within the material is 
      \begin{align}
        \overline{K_B} &= \frac{\int_{R_F}^{R_B} K_B(T_B(r)) \, r \; dr}
          {\int_{R_F}^{R_B} r \; dr} \\
        \label{eq:kb_integral}
        \overline{K_B} &= \frac{\int_{R_F}^{R_B} \left( K_B(T_F) -
          \frac{q'''_c}{2} R_F^2 \ln\left(\frac{r}{R_F}\right) \right) \, r \;
          dr} {\int_{R_F}^{R_B} r \; dr}
      \end{align}
      with the weighting due to radial coordinates included.
      Evaluating the denominator of \eref{eq:kb_integral}.
      \begin{align}
        \int_{R_F}^{R_B} r \; dr &= \left. \frac{r}{2} \right|_{r=R_F}^{r=R_B}\\
        \label{eq:kb_denominator}
        \int_{R_F}^{R_B} r \; dr &= \frac{R_B^2 - R_F^2}{2}
      \end{align}
      The integral in the numerator of \eref{eq:kb_integral} is more than a
      simple polynomial. The integral $\int \ln(r \, \alpha) \, r \; dr$ is given
      in a table of integrals. Then, the numerator of \eref{eq:kb_integral} can
      be evaluated. 
      \begin{equation}
        \int_{R_F}^{R_B} \left( K_B(T_F) - \frac{q'''_c}{2} R_F^2
          \ln\left(\frac{r}{R_F}\right) \right) r dr 
          = \int_{R_F}^{R_B}
          \left( K_B(T_F) \, r - \frac{q'''_c}{2}R_F^2
          \ln\left(\frac{r}{R_F}\right) \, r \right) \; dr
      \end{equation}
      \begin{multline}
        \int_{R_F}^{R_B} \left( K_B(T_F) - \frac{q'''_c}{2} R_F^2
          \ln\left(\frac{r}{R_F}\right) \right) r dr =\\
        \left. K_B(T_F) \frac{r^2}{2} \right|_{r=R_F}^{r=R_B} - 
          \left. \frac{q'''_c}{2}R_F^2 \left( \frac{r^2}{2}
          \ln\left(\frac{r}{R_F}\right) - \frac{r^2}{4} \right)
          \right|_{r=R_F}^{r=R_B}
      \end{multline}
      \begin{multline}
        \label{eq:kb_numerator}
        \int_{R_F}^{R_B} \left( K_B(T_F) - \frac{q'''_c}{2} R_F^2
          \ln\left(\frac{r}{R_F}\right) \right) r dr = \\
        K_B(T_F) \frac{R_B^2-R_F^2}{2} - \frac{q'''_c}{2} R_F^2
          \left( \frac{R_F^2 - R_B^2}{4} + \frac{R_B^2}{2}
          \ln\left(\frac{R_B}{R_F}\right) \right)
      \end{multline}
      With these expressions, \eref{eq:kb_integral} can be evaluated by dividing
      \eref{eq:kb_numerator} by \eref{eq:kb_denominator} and simplifying.
      \begin{equation}
        \label{eq:kb_bar}
        \overline{K_B} = K_B(T_F) - \frac{q'''_c}{4} \, R_F^2 \, \left(
          \frac{R_F^2 - R_B^2 + 2\,R_B^2 \ln\left(\frac{R_B}{R_F}\right)}
          {R_B^2-R_F^2}\right)
      \end{equation}
      Using \eref{eq:kb_bar}, the average bond temperature $\overline{T_B}$ can
      be evaluated assuming $\overline{K_B}=K_B(\overline{T_B})$. This solution
      is performed using a numerical method. Specifically, $\overline{T_B}$ is
      then solved using the bisection method.

    \subsubsection{Average Clad Temperature}
      The calculation of the average clad temperature is similar to the
      calculation of the average bond temperature because both of these regions
      have no heat generation and the expressions for the conductivity integral
      in these regions are similar. A derivation procedure similar to
      \sref{sec:average_bond_temp} and the result will be similar. Therefore,
      the average value of the conductivity integral in the cladding is 
      \begin{equation}
        \label{eq:kc_bar}
        \overline{K_C} = K_C(T_B) - \frac{q'''}{4} R_F^2 \left(
          \frac{R_B^2 - R_C^2 + 2 \, R_C^2 \ln\left(\frac{R_C}{R_B}\right)}
          {R_C^2 - R_B^2} \right)
      \end{equation}
      where $T_B$ is the bond surface temperature. With the use of
      \eref{eq:kc_bar}, the average clad temperature $\overline{T_C}$ can be
      calculated assuming $\overline{K_C} = K_C(\overline{T_C})$ using a
      numerical solution method. In this application, value $\overline{T_C}$ is
      evaluated using \eref{eq:kc_bar} and the bisection method.

\section{Cross Section Treatment}
  Realistic cross-sections are pivotal to a realistic reactor simulation. There
  are two basic parts to cross-section treatment. First is the generation of
  cross-section libraries. The key to generating these libraries is using a
  representative flux spectrum for the many-group to multigroup collapse. It is
  impossible to know the exact spectrum at the time of library generation so an
  approximation decision must be made.
  For fissile compositions, the spectrum is given by the
  fission spectrum of the composition in some simplified geometry. For 
  non-fissile compositions, a flux spectrum and simplified geometry must be 
  assumed.  Using these flux spectra, the libraries must be generated at 
  selected temperatures to capture the effects of Doppler broadening.

  The second part of cross-section treatment is the calculation of effective
  multigroup constants given these cross-section libraries. This calculation
  assume an interpolation method between the temperatures used to generate the
  libraries. The simplest interpolation method is linear interpolation and this
  is valid for materials minimally effected by Doppler broadening. Such 
  materials include cladding and sodium as these materials do not change
  temperature significantly over the operating range of the reactor and have
  relatively few neutron absorption resonances. The fuel material is
  interpolated according to a square-root interpolation because the Doppler
  effect obeys square-root behavior. This square-root interpolation is necessary
  due to relatively high fuel temperatures and the many neutron absorption
  resonances in fuel material, specifically Uranium.

  \subsection{Cross Section Library Generation}
    State-of-the-art fast reactor simulations utilize cross-sections generated
    from \mcc. This code from Argonne National Laboratory (ANL) allows for the
    generation of mulitgroup constants useful for solution of the neutron
    diffusion equation. The calculation in \mcc begins with a 2,082 fine-group
    neutron library based on ENDF-VII data and can be collapsed to an
    arbitrary, user-specified, energy group structure. For this application, the
    recommended and default 33-group structure is used. In fissile media, the
    energy spectrum used for the collapse is based on the fission spectrum of
    the media. In non-fissile media, a default \isotope[238]{U} fission spectrum
    is used \cite{mcc}.
    
    The collapse simplifies the geometry to an infinite and homogeneous medium.
    To reasonably simulate the energy spectrum within a hexagonal assembly,
    cross-sections are collapsed assuming an infinite homogeneous mixture 
    composed of a single hexagonal assembly. Number densities are calculated 
    such that the number density in the assembly is the number density within
    the material region weighted by the area fraction of that region. Area
    fractions are calculated by using \eref{eq:afrac_first} through 
    \eref{eq:afrac_last}.
    
    To capture the effect of Doppler broadening, cross-section libraries are
    generated for several different material temperatures.
    It is known that the effect of temperature on cross-sections are most
    significant in the fuel region where temperatures can be extreme at high
    reactor powers. Compared to the fuel temperature, the coolant and cladding
    temperatures change relatively little over the operating range of a
    sodium-cooled fast reactor.
    While fuel, clad, and coolant temperatures can be related as above (see
    \sref{sec:radial_conduction_model}), these
    relationships are functions of reactor power, $Q_{Rx}$, and reactor 
    coolant mass flow rate, $\mdot_{Rx}$, and these values are not known before 
    the simulation for a general reactor. Instead, a simplified temperature 
    relationship is used to generate the cross-section libraries.

    In each cross-section library, the coolant is maintained at some nominal
    temperature. For this application, that temperature is $400 \units{K}$
    (note: sodium melting temperature 371 \units{K}). Maintaining the coolant
    temperature as constant in this manner
    is acceptable because the dominant effect of temperature on the macroscopic
    cross-sections in the coolant is the density change of the fluid, not the
    Doppler effect. With constant coolant temperature, the fuel temperature is
    then varied over some range. For this application, libraries are generated
    for average fuel temperatures of 
    $400 \units{K}$, $600 \units{K}$, $900 \units{K}$, and $1200 \units{K}$. For
    each fuel temperature, the clad temperature is related as 
    \begin{equation}
      T_{clad} = w \, T_{fuel} + (1-w) \, T_{cool}
    \end{equation}
    where $T_{fuel}$ is the chosen fuel temperature for the library and
    $T_{cool}$ is the chosen coolant temperature, $400 \units{K}$. For this 
    application a weighting of $w=0.4$ provided acceptable results. Temperature
    in non-fissile assemblies is set to $T_{cool}$ during the collapse as there
    is no heat generated in these assemblies and in the steady-state axial
    convection model, non-fissile assemblies will have temperature equal to 
    $T_{inlet}$.

    \begin{table}
      \caption{Temperatures Selected for Cross-Section Libraries.}
      \label{tab:xstemps}
      \begin{center}
        \begin{tabular}{lll}
          \toprule
          $T_{cool} \units{K}$ & $T_{clad} \units{K}$ & $T_{fuel} \units{K}$ \\
          \midrule
          400 & 400 & 400  \\
          400 & 480 & 600  \\
          400 & 600 & 900  \\
          400 & 720 & 1200 \\
          \bottomrule
        \end{tabular}
      \end{center}
    \end{table}

    Ultimately, the cross-sections are accumulated as four separate libraries at
    temperatures given in \tref{tab:xstemps}. These cross-sections are generated
    at the temperatures specified and the collapses are performed assuming an
    infinite homogeneous mixture of a single assembly. With these libraries
    generated, the average material temperatures calculated in 
    \sref{sec:average_temps} are used to calculate cross-sections within each
    material using an interpolation method.

  \subsection{Temperature Dependent Cross Section Calculation}
    Given cross-section libraries calculated at selected temperatures, an
    interpolation method can be used to calculate the cross-section at a 
    specific temperature.  The temperature interpolation is unique for each 
    material region and each region is briefly discussed.

    Reactor material temperatures are updated periodically throughout the 
    neutron diffusion calculation. The user may specify a fixed number of power
    iterations for which the diffusion calculation will run before updating the
    temperatures.
    For a discussion of power iterations, see \sref{sec:power_iterations}. When
    the temperatures are updated, the cross-sections are also updated. Note that
    this update of cross-sections during a power iteration makes the iterative
    method non-linear and the convergence of the method is no longer guaranteed.
    Experimentally, convergence behaves acceptably for typical cases. The
    general procedure to update cross sections is given in
    \algorithmref{algorithm:temperature_update}.

    In \algorithmref{algorithm:temperature_update}, the cross-sections are
    updated using the average material temperatures. Average material
    temperatures are unique within each chunk. Therefore, instead of having
    cross-sections constant throughout the reactor and only a function of
    material, cross sections are now unique and uniquely updated within each
    chunk.

    \begin{algorithm}
      \caption{Temperature and Cross-Section Update Procedure.}
      \label{algorithm:temperature_update}
      \begin{algorithmic}[1]
        \State Calculate flux normalization constant $c$ from
          \eref{eq:normalization_c}.
        \State Calculate power and volumetric power in the fuel for each element
          as in \eref{eq:elementpwr} and \eref{eq:elementqppp_fuel}.
        \State Calculate power and volumetric power in the fuel for each chunk
          as in \eref{eq:chunkpwr} and \eref{eq:chunkqppp_fuel}.
        \State Calculate bulk coolant temperature in each chunk using the 
          procedure outlined in \sref{sec:axial_convection_model}.
        \State Calculate surface temperatures and fuel center-line temperature
          using the procedure in \sref{sec:surface_temps}.
        \State Calculate material average temperatures using the procedure 
          outlined in \sref{sec:average_temps}.
        \State Update cross sections using average material temperatures.
      \end{algorithmic}
    \end{algorithm}

    \subsubsection{Coolant Cross Sections}
      The main effect on coolant cross sections due to temperature is the change
      in the fluid density. The mass-density of the of liquid sodium (as used in
      sodium-cooled fast reactors) is given as a function of temperature
      $\rho(T)$ by a state relationship in \cite{sodiumProp}. Natural sodium is
      entirely composed of \isotope[23]{Na} and has atomic weight $M_{Na} =
      22.989769281 \units{$\frac{\text{gram}}{\text{mol}}$}$ \cite{nuclides}.
      Then, the number density of the coolant is given as
      \begin{equation}
        \label{eq:number_density_sodium}
        N_{Na}(T) = \frac{\rho_{Na}(T) \, N_A}{M_{Na}}
      \end{equation}
      where $N_A$ is Avogadro's number. When temperatures are calculated and
      cross sections are updated, the number density of sodium is updated and
      cross sections are calculated. 
      
      In the temperature dependent cross-section library structure described in
      \tref{tab:xstemps}, all coolant temperatures are the same. Then, the
      macroscopic cross section in the coolant for reaction $x$ is given as
      \begin{equation}
        \Sigma_x = N_{Na}(T) \; \sigma_x
      \end{equation}
      where $N_{Na}$ is calculated according to \eref{eq:number_density_sodium}.

      If, instead, the microscopic coolant temperature was varied as a function
      of temperature, a linear interpolation is performed for $T_{i}<T<T_{i+1}$
      according to
      \begin{equation}
        \Sigma_{x} = N_{Na}(T) 
          \left( \frac{T - T_{i}}{T_{i+1}-T_{i}} 
          (\sigma_{x,i+1} - \sigma_{x,i})  + \sigma_{x,i}\right)
      \end{equation}
      where $\sigma_i$ and $\sigma_{i+1}$ are the microscopic cross-sections
      that correspond to temperatures $T_i$ and $T_{i+1}$ respectively.

    \subsubsection{Clad Cross Sections}
      Cross-section temperature dependence within the cladding is due to the
      Doppler effect. Macroscopic cross-sections are tabulated based on the
      cross-section library data at temperatures specified in
      \tref{tab:xstemps}. The Doppler effect is typically small as cladding
      material has fewer absorption resonances than fuel material and cladding
      material does not change temperature as extremely as other reactor
      materials. Because this effect is relatively small, a simple linear
      interpolation is used to interpolate macroscopic cross sections within
      this material. For $T_i < T < T_{i+1}$, the macroscopic cross-section for
      reaction $x$ according to the linear interpolation method is given as
      \begin{equation}
        \label{eq:xs_linear_interpolation}
        \Sigma_{x} = 
          \frac{T - T_{i}}{T_{i+1}-T_{i}} 
          (\Sigma_{x,i+1} - \Sigma_{x,i})  + \Sigma_{x,i}
      \end{equation}
      where $\Sigma_{x,i}$ and $\Sigma_{x,i+1}$ are the macroscopic
      cross-sections that correspond to temperatures $T_i$ and $T_{i+1}$
      respectively. 

    \subsubsection{Bond Cross Sections}
      While the average bond temperature is computed, the temperature dependence
      of bond cross sections is neglected. This is because the bond represents a
      miniscule volume of the reactor and the sodium cross-sections within this
      region do not dictate any larger-scale reactor physics. The bond is the 
      same material as the coolant (sodium). If all coolant (sodium) 
      cross-sections are provided at the same temperature as in 
      \tref{tab:xstemps}, the bond cross sections are set to the same as the 
      coolant cross sections. If the sodium cross sections are provided at
      various temperatures, a linear interpolation is performed according to
      \eref{eq:xs_linear_interpolation}. The assumption that this region has the
      same cross-sections as the coolant has negligible effect on the solution.

    \subsubsection{Fuel Cross Sections}
      Temperature dependence of cross-sections in the fuel region is dominated
      by the Doppler effect. This effect may be large for high fuel temperatures
      and it is important that for realistic cross-sections, this effect be
      simulated properly. Macroscopic cross-sections are tabulated based on
      library data at temperatures specified in \tref{tab:xstemps}. Then, a
      square-root interpolation method is used. The square-root interpolation is
      commonly selected for cross-section interpolation because the Doppler
      effect follow square-root behavior closely. For $T_i < T < T_{i+1}$, the
      macroscopic cross-section for reaction $x$ within the fuel is calculated
      as
      \begin{equation}
        \Sigma_{x} = 
          \frac{\sqrt{T} - \sqrt{T_{i}}}{\sqrt{T_{i+1}}-\sqrt{T_{i}}}
          (\Sigma_{x,i+1} - \Sigma_{x,i})  + \Sigma_{x,i}
      \end{equation}
      where $\Sigma_{x,i}$ and $\Sigma_{x,i+1}$ are the macroscopic
      cross-sections of reaction $x$ corresponding to $T_i$ and $T_{i+q}$
      respectively.
      
\section{Thermal Hydraulic Results}
  To demonstrate the expected behavior of these models, axial and radial
  temperature plots are generated. The radial solution is only generated to
  demonstrate the expected behavior as the radial temperature functions
  themselves are not used in the reactor simulation. The axial solution comes
  from a typical reactor simulation and demonstrates the expected behaviors for
  system temperatures.

  \subsection{Radial Results}
    Radial temperatures for a single-pin model are shown in
    \fref{fig:radial_temp_plot}. This model was generated for $q'''_c = 1.8
    \times 10^5 \units{$\frac{\text{W}}{\text{m}^3}$}$ and $\mdot_h = 10^3
    \units{$\frac{\text{kg}}{\text{s}}$}$ which are typical values. It is seen
    that the temperature profile within the fuel region is approximately 
    quadratic and temperature profiles in the bond and clad are approximately
    linear. These are the expected behavior for a constant thermal conductivity
    in each region. Additionally, it is seen that the average temperatures as
    calculated above reasonably approximate the average temperature within each
    material. For this case, it was observed that a numeric integration method
    to calculate the average temperature and the calculation method described in
    \sref{sec:average_temps} agreed to within $1 \units{K}$.

    \begin{figure}
      \centering
      \includegraphics[width=0.7\textwidth]{radial_temp_plot}
      \caption{Radial Temperatures for Typical Reactor Conditions.}
      \label{fig:radial_temp_plot}
    \end{figure}

  \subsection{Axial Results}
    Axial temperatures for a single assembly are shown in
    \fref{fig:axial_temp_plot}. This plot was generated by solving the neutron
    diffusion problem for a typical reactor to estimate a heat generation
    profile. Then, the temperatures were calculated at each level.
    \fref{fig:axial_temp_plot} contains average material temperatures used in
    the calculations of cross sections for the example reactor simulation. These
    temperatures were output by the code itself.

    \begin{figure}
      \centering
      \includegraphics[width=0.7\textwidth]{axial_temp_plot}
      \caption{Axial Temperatures for Typical Reactor Conditions.}
      \label{fig:axial_temp_plot}
    \end{figure}

% todo this will probably be a separate chapter and include thermal expansion
%\section{Results}
%  \subsection{Single Pin Model}
%  \subsection{Reactor Simulation}
